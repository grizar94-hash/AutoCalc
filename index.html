<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</title>

<!-- Open Graph –¥–ª—è –ø—Ä–µ–≤—å—é -->
<meta property="og:type" content="website" />
<meta property="og:title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏" />
<meta property="og:description" content="–†–∞—Å—Å—á–∏—Ç–∞–π –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å ¬´–ø–æ–¥ –∫–ª—é—á¬ª –≤ —Ä—É–±–ª—è—Ö –∏ USDT." />
<meta property="og:url" content="https://grizar94-hash.github.io/AutoCalc/" />
<meta property="og:image" content="https://grizar94-hash.github.io/AutoCalc/share.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<link rel="icon" href="icon.png" type="image/png" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="manifest" href="manifest.json" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

<!-- jsPDF + html2canvas –¥–ª—è PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-YtdkXb3o0H4w2k8Oq7j0P2l1s9t4dQZxkA3lK7m5m3oN2PpQrvb7sWw1m0oWkYw3Jw6s7G7Kk7q1b0m5mQe7kQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNa5zs6b3bC8k8a5nY0qg3w0KkEwqkV3Gz7nF8H2Xw7nZ0mGkz6cF4k9y2mFJ8+0n8j2XU7p7J3q8l8c+uHfDw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
  :root {
    --blue:#0b69ff;
    --bg:#f0f2f5;
    --card-shadow:0 4px 10px rgba(0,0,0,.1);
  }
  *{box-sizing:border-box}
  body{
    font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
    background:var(--bg);
    color:#111;
    margin:0;
    padding:20px;
    overflow-x:hidden;
  }
  .wrap{max-width:720px;margin:0 auto}
  h2{margin:0 0 20px;text-align:center;color:var(--blue)}
  .section{
    padding:20px;margin-bottom:15px;border-radius:12px;color:#fff;
    box-shadow:var(--card-shadow);transition:background .3s;
  }
  .korea{background:#4fc3f7}
  .currency{background:#26a69a}
  .russia{background:#81c784}
  .section h3{margin:0 0 6px}
  .section label{display:block;margin-top:10px;font-weight:700}
  input{
    width:100%;padding:10px;margin-top:6px;border-radius:8px;border:none;font-size:16px;
  }
  .insurance-row{
    display:flex;align-items:center;gap:10px;margin:12px 0 4px;
    background:#f7f7f8;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;
    box-shadow:var(--card-shadow);
  }
  .insurance-row input{width:20px;height:20px}
  .insurance-row label{flex:1;font-weight:600;line-height:1.3}

  button{
    width:100%;padding:14px;margin-top:15px;font-size:18px;border:none;border-radius:10px;
    cursor:pointer;background:var(--blue);color:#fff;font-weight:700;transition:background .2s;
    box-shadow:var(--card-shadow);
  }
  button:hover{background:#0756d1}
  button.clear{background:#ccc;color:#111}
  button.pdf{background:#000;color:#fff}

  .result{
    margin-top:20px;padding:20px;border-radius:12px;background:#fff3e0;font-size:18px;
    box-shadow:var(--card-shadow)
  }
  .result p{margin:10px 0;font-weight:700}
  hr{border:0;border-top:2px dashed #ccc;margin:10px 0}
  footer{margin:32px 0 8px;text-align:center;color:#777;font-size:12px}
</style>
</head>
<body>
<main class="wrap">

  <h2>üöó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</h2>

  <div class="section korea" id="blockKorea">
    <h3>üá∞üá∑ –ö–æ—Ä–µ—è</h3>
    <label>–¶–µ–Ω–∞ –∞–≤—Ç–æ (‚Ç©): <input type="number" id="priceKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∞–≤—Ç–æ"></label>
    <label>–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (‚Ç©): <input type="number" id="expensesKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã"></label>
  </div>

  <div class="section currency" id="blockCurrency">
    <h3>üí± –ö—É—Ä—Å –≤–∞–ª—é—Ç</h3>
    <label>USDT ‚Üí ‚ÇΩ: <input type="number" id="rubUsdt" placeholder="–°–∫–æ–ª—å–∫–æ —Ä—É–±–ª–µ–π –∑–∞ 1 USDT" step="0.1"></label>
    <label>USDT ‚Üí ‚Ç©: <input type="number" id="usdtKrw" placeholder="–°–∫–æ–ª—å–∫–æ –≤–æ–Ω –∑–∞ 1 USDT" step="0.1"></label>
  </div>

  <div class="section russia" id="blockRussia">
    <h3>üá∑üá∫ –†–æ—Å—Å–∏—è</h3>
    <label>–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã (‚ÇΩ): <input type="number" id="dutyRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 150000"></label>
    <label>–¢–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —É—Å–ª—É–≥–∏ –±—Ä–æ–∫–µ—Ä–∞ (‚ÇΩ): <input type="number" id="brokerRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 70000"></label>
    <label>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ (‚ÇΩ): <input type="number" id="deliveryRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 50000"></label>
  </div>

  <div class="insurance-row">
    <input type="checkbox" id="insuranceCheck" />
    <label for="insuranceCheck">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É 0,3% –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã</label>
  </div>

  <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è</button>
  <button class="pdf" onclick="downloadPDF()">üìÑ –°–∫–∞—á–∞—Ç—å PDF-–æ—Ç—á—ë—Ç</button>

  <div class="result" id="result"></div>

  <footer>¬© Harmex Auto Export</footer>
</main>

<script>
  // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
  function animateValue(id, start, end, duration){
    const el=document.getElementById(id); const rng=end-start; let t0=null;
    function step(ts){ if(!t0) t0=ts; const p=Math.min(1,(ts-t0)/duration);
      const v=Math.floor(start + rng*p);
      el.textContent = v.toLocaleString('ru-RU')+' ‚ÇΩ';
      if(p<1) requestAnimationFrame(step); else el.textContent=end.toLocaleString('ru-RU')+' ‚ÇΩ';
    }
    requestAnimationFrame(step);
  }

  function calculate(){
    const priceKrw=+document.getElementById('priceKrw').value||0;
    const expensesKrw=+document.getElementById('expensesKrw').value||0;
    const rubUsdt=+document.getElementById('rubUsdt').value||0;
    const usdtKrw=+document.getElementById('usdtKrw').value||0;
    const dutyRub=+document.getElementById('dutyRub').value||0;
    const brokerRub=+document.getElementById('brokerRub').value||0;
    const deliveryRub=+document.getElementById('deliveryRub').value||0;
    const insuranceOn=document.getElementById('insuranceCheck').checked;

    const totalKrw=priceKrw+expensesKrw;
    const rubNeeded = usdtKrw ? (totalKrw/usdtKrw)*rubUsdt : 0;
    const preFinal = rubNeeded + dutyRub + brokerRub + deliveryRub;
    const insurance = insuranceOn ? preFinal*0.003 : 0;
    const finalSum = preFinal + insurance;

    // –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã
    document.getElementById('blockKorea').style.background='#29b6f6';
    document.getElementById('blockRussia').style.background='#66bb6a';
    document.getElementById('result').style.background='#ffe0b2';

    document.getElementById('result').innerHTML = `
      <p>üí∞ –í –ö–æ—Ä–µ–µ: <span id="valKorea">0 ‚ÇΩ</span></p>
      <p>üí∞ –í –†–æ—Å—Å–∏–∏: <span id="valRussia">0 ‚ÇΩ</span></p>
      ${insuranceOn ? `<p>üõ°Ô∏è –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: <span id="valInsurance">0 ‚ÇΩ</span></p>` : ''}
      <hr>
      <p>üèÅ –ü–æ–¥ –∫–ª—é—á: <span id="valFinal">0 ‚ÇΩ</span></p>
    `;

    animateValue('valKorea',0,Math.round(rubNeeded),900);
    animateValue('valRussia',0,Math.round(dutyRub+brokerRub+deliveryRub),900);
    if(insuranceOn) animateValue('valInsurance',0,Math.round(insurance),900);
    animateValue('valFinal',0,Math.round(finalSum),1100);

    // —Å–æ—Ö—Ä–∞–Ω–∏–º –¥–ª—è PDF
    window.__calcLast={
      korea:Math.round(rubNeeded),
      russia:Math.round(dutyRub+brokerRub+deliveryRub),
      insurance:Math.round(insurance),
      final:Math.round(finalSum),
      insuranceOn
    };
  }

  function clearAll(){
    ['priceKrw','expensesKrw','rubUsdt','usdtKrw','dutyRub','brokerRub','deliveryRub']
      .forEach(id=>document.getElementById(id).value='');
    document.getElementById('insuranceCheck').checked=false;
    document.getElementById('result').innerHTML='';
    document.getElementById('blockKorea').style.background='#4fc3f7';
    document.getElementById('blockRussia').style.background='#81c784';
    window.__calcLast = null;
  }

  // PDF: —à–∞–ø–∫–∞ —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º —Å–ª–µ–≤–∞ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ —Å–ø—Ä–∞–≤–∞, —Ç–æ–Ω–∫–∞—è —á—ë—Ä–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ —Å–≤–µ—Ä—Ö—É.
  async function downloadPDF(){
    const resBlock=document.getElementById('result');
    const hasData = resBlock && resBlock.innerText.trim().length>0;
    if(!hasData){ alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á—ë—Ç.'); return; }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:'mm', format:'a4' });

    // –°–æ–±–∏—Ä–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π ¬´—á–∏—Å—Ç–æ–≤–∏–∫¬ª –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ (html2canvas —Å–æ—Ö—Ä–∞–Ω–∏—Ç –∫–∏—Ä–∏–ª–ª–∏—Ü—É)
    const page = document.createElement('div');
    page.style.cssText = `
      position:fixed; left:-99999px; top:0; width:794px; /* —à–∏—Ä–∏–Ω–∞ A4 @96dpi */
      background:#fff; color:#000; font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      padding:0; margin:0;
    `;

    // –ü–æ–ª–æ—Å–∞ —Å–≤–µ—Ä—Ö—É
    const topBar=document.createElement('div');
    topBar.style.cssText='height:10px; background:#111; width:100%;';
    page.appendChild(topBar);

    // –®–∞–ø–∫–∞ (–ª–æ–≥–æ—Ç–∏–ø —Å–ª–µ–≤–∞, –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å–ø—Ä–∞–≤–∞)
    const header=document.createElement('div');
    header.style.cssText='display:flex; justify-content:space-between; align-items:flex-start; padding:20px 24px 0 24px;';

    const logo=document.createElement('img');
    logo.src='logo.png';
    logo.alt='Harmex';
    logo.style.cssText='height:70px; object-fit:contain;';
    header.appendChild(logo);

    const contacts=document.createElement('div');
    contacts.style.cssText='text-align:right; font-size:12px; line-height:1.5;';
    contacts.innerHTML = `
      <strong style="font-size:14px">Harmex</strong><br>
      ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏: 749-11-02981<br>
      Tel: +82 10 3056 0903<br>
      Email: annamoloz95@gmail.com<br>
      Address: 201, 42 Hambak-ro84beon-gil,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Yeonsu-dong, Yeonsu-gu, Incheon, South Korea<br>
      Director: Molozhavaia Anna
    `;
    header.appendChild(contacts);
    page.appendChild(header);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –¥–∞—Ç–∞
    const title=document.createElement('div');
    title.textContent='–û—Ç—á—ë—Ç –ø–æ —Ä–∞—Å—á—ë—Ç—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏–∑ –ö–æ—Ä–µ–∏';
    title.style.cssText='text-align:center; font-weight:700; font-size:20px; margin:14px 24px 4px;';
    page.appendChild(title);

    const date=document.createElement('div');
    date.textContent='–î–∞—Ç–∞: ' + new Date().toLocaleDateString('ru-RU');
    date.style.cssText='text-align:center; font-size:12px; color:#333; margin-bottom:10px;';
    page.appendChild(date);

    // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
    const hr=document.createElement('div');
    hr.style.cssText='height:1px; background:#111; margin:6px 24px 12px;';
    page.appendChild(hr);

    // –¢–µ–ª–æ –æ—Ç—á—ë—Ç–∞ (–ø–µ—Ä–µ–≤–æ–¥–∏–º –∫–∞—Ä—Ç—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —ç–º–æ–¥–∑–∏)
    const body=document.createElement('div');
    body.style.cssText='font-size:14px; line-height:1.6; margin:0 24px 24px;';
    const txt = resBlock.innerText
      .replace('üí∞','').replace('üí∞','').replace('üõ°Ô∏è','').replace('üèÅ','')
      .replace(/\s+‚ÇΩ/g,' ‚ÇΩ'); // —á—É—Ç—å –∫—Ä–∞—Å–∏–≤–µ–µ –ø—Ä–æ–±–µ–ª—ã
    body.innerHTML = txt.replace(/\n/g,'<br>');
    page.appendChild(body);

    // –ù–∏–∂–Ω—è—è –ø–æ–¥–ø–∏—Å—å
    const footer=document.createElement('div');
    footer.style.cssText='font-size:11px; color:#555; margin:20px 24px 24px; text-align:left;';
    footer.textContent = '–ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞—Å—á—ë—Ç–∞: https://grizar94-hash.github.io/AutoCalc/';
    page.appendChild(footer);

    document.body.appendChild(page);

    // –†–µ–Ω–¥–µ—Ä–∏–º –≤ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –ø–æ–º–µ—â–∞–µ–º –Ω–∞ A4
    const canvas = await html2canvas(page, { scale:2 });
    const imgData = canvas.toDataURL('image/png');
    const pw = doc.internal.pageSize.getWidth();
    const ph = doc.internal.pageSize.getHeight();
    const ratio = canvas.height / canvas.width;
    let ih = pw * ratio;
    let y = 0;

    // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª–∏–Ω–Ω–µ–µ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
    if (ih <= ph) {
      doc.addImage(imgData, 'PNG', 0, 0, pw, ih);
    } else {
      // –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ
      const pageCanvas = document.createElement('canvas');
      const pageCtx = pageCanvas.getContext('2d');
      const pxPerMm = canvas.width / pw;
      const sliceHeightPx = ph * pxPerMm;

      let renderedHeight = 0;
      while (renderedHeight < canvas.height) {
        pageCanvas.width = canvas.width;
        pageCanvas.height = Math.min(sliceHeightPx, canvas.height - renderedHeight);
        pageCtx.drawImage(canvas, 0, renderedHeight, canvas.width, pageCanvas.height, 0, 0, canvas.width, pageCanvas.height);
        const pageImg = pageCanvas.toDataURL('image/png');
        if (y === 0) {
          doc.addImage(pageImg, 'PNG', 0, 0, pw, (pageCanvas.height / pxPerMm));
        } else {
          doc.addPage();
          doc.addImage(pageImg, 'PNG', 0, 0, pw, (pageCanvas.height / pxPerMm));
        }
        renderedHeight += pageCanvas.height;
        y += (pageCanvas.height / pxPerMm);
      }
    }

    doc.save('calc-report.pdf');
    document.body.removeChild(page);
  }
</script>
</body>
</html>
