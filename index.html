<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</title>

<link rel="icon" href="icon.png" type="image/png" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="manifest" href="manifest.json" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root { --blue:#0b69ff; --bg:#f0f2f5; --shadow:0 4px 10px rgba(0,0,0,.1); }
  *{ box-sizing:border-box }
  body{ font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif; background:var(--bg); color:#111; margin:0; padding:20px; overflow-x:hidden; }
  .wrap{ max-width:720px; margin:0 auto; }
  h2{ text-align:center; color:var(--blue); margin:0 0 20px; }
  .section{ padding:20px; margin-bottom:15px; border-radius:12px; color:#fff; box-shadow:var(--shadow); transition:background .3s; }
  .currency{ background:#26a69a } .korea{ background:#4fc3f7 } .russia{ background:#81c784 }
  .section h3{ margin:0 0 6px }
  .section label{ display:block; margin-top:10px; font-weight:700 }
  input, select{ width:100%; padding:10px; margin-top:6px; border-radius:8px; border:none; font-size:16px; }
  .row{ display:flex; gap:10px; flex-wrap:wrap } .row>div{ flex:1 1 200px }
  .subpanel{ margin-top:12px; background:#f7f7f8; border:1px solid #e5e7eb; border-radius:10px; padding:12px; color:#111; }
  .subpanel h4{ margin:0 0 8px; font-size:16px; color:#0f172a }
  .note{ font-size:12px; color:#475569; margin-top:6px }
  .muted{ color:#64748b; font-weight:600; font-size:12px }
  .auto-output{ background:#fff8e1 }
  .radio-line{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
  .radio-line label{ font-weight:600; color:#111; background:#e2e8f0; padding:6px 10px; border-radius:8px; cursor:pointer }
  .radio-line input{ width:auto; margin-right:6px }
  .grid{ display:grid; grid-template-columns: 1fr auto; gap:8px 10px; align-items:center }

  .toggle-btn, button{
    width:100%; padding:14px; margin-top:15px; font-size:18px; border:none; border-radius:10px;
    cursor:pointer; background:var(--blue); color:#fff; font-weight:700; transition:.2s; box-shadow:var(--shadow);
  }
  button:hover, .toggle-btn:hover{ background:#0756d1 }
  .toggle-btn.active{ background:#0aa84f; }
  button.clear{ background:#ccc; color:#111 }
  .pdf{ background:#0b69ff; color:#fff }

  .result{ margin-top:20px; padding:20px; border-radius:12px; background:#fff3e0; font-size:18px; box-shadow:var(--shadow); }
  .result p{ margin:10px 0; font-weight:700 }
  hr{ border:0; border-top:2px dashed #ccc; margin:10px 0 }
</style>
</head>
<body>
<main class="wrap">
  <h2>üöó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</h2>

  <!-- 1) –ö–£–†–°–´ –í–ê–õ–Æ–¢ -->
  <div class="section currency" id="blockCurrency">
    <h3>üí± –ö—É—Ä—Å –≤–∞–ª—é—Ç</h3>

    <div class="row">
      <div>
        <label>USDT ‚Üí ‚ÇΩ:
          <input type="number" id="rubUsdt" placeholder="–∞–≤—Ç–æ" step="0.0001">
        </label>
        <div class="note" id="usdtSrc">–ò—Å—Ç–æ—á–Ω–∏–∫: ‚Äî</div>
      </div>

      <div>
        <label>USDT ‚Üí ‚Ç©:
          <input type="number" id="usdtKrw" placeholder="–∞–≤—Ç–æ" step="0.01">
        </label>
        <div class="note" id="usdtSrc2">–ò—Å—Ç–æ—á–Ω–∏–∫: ‚Äî</div>
      </div>
    </div>

    <div class="subpanel">
      <div class="grid">
        <div class="muted">–ö—É—Ä—Å EUR ‚Üí ‚ÇΩ (–¶–ë)</div>
        <input class="auto-output" id="eurRub" placeholder="–∞–≤—Ç–æ" readonly>
        <div class="muted">–ö—É—Ä—Å KRW ‚Üí ‚ÇΩ (–¶–ë)</div>
        <input class="auto-output" id="krwRub" placeholder="–∞–≤—Ç–æ" readonly>
      </div>
      <div class="note" id="cbrSrc">–ö—É—Ä—Å—ã –¶–ë –†–§ –Ω–∞ ‚Äî</div>
    </div>
  </div>

  <!-- 2) –ö–û–†–ï–Ø -->
  <div class="section korea" id="blockKorea">
    <h3>üá∞üá∑ –ö–æ—Ä–µ—è</h3>
    <label>–¶–µ–Ω–∞ –∞–≤—Ç–æ (‚Ç©): <input type="number" id="priceKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∞–≤—Ç–æ"></label>
    <label>–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (‚Ç©): <input type="number" id="expensesKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã"></label>
  </div>

  <!-- 3) –†–û–°–°–ò–Ø -->
  <div class="section russia" id="blockRussia">
    <h3>üá∑üá∫ –†–æ—Å—Å–∏—è</h3>

    <div class="subpanel" id="autoCustoms">
      <h4>‚öôÔ∏è –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –∏ —Å–±–æ—Ä–æ–≤</h4>

      <div class="row">
        <div>
          <div class="muted">–¢–∏–ø –≤–≤–æ–∑—è—â–µ–≥–æ</div>
          <div class="radio-line">
            <label><input type="radio" name="importer" value="individual" checked> –§–∏–∑–ª–∏—Ü–æ</label>
            <label><input type="radio" name="importer" value="business"> –Æ—Ä–ª–∏—Ü–æ / –ò–ü</label>
          </div>
        </div>
        <div>
          <div class="muted">–¢–∏–ø –¥–≤–∏–≥–∞—Ç–µ–ª—è</div>
          <div class="radio-line">
            <label><input type="radio" name="eng" value="ice" checked> –î–í–°</label>
            <label><input type="radio" name="eng" value="ev"> –≠–ª–µ–∫—Ç—Ä–æ</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsICE">
        <div>
          <label>–û–±—ä—ë–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (—Å–º¬≥): <input type="number" id="engineCc" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 1998"></label>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç</div>
          <div class="radio-line">
            <label><input type="radio" name="age" value="<3"> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age" value="3-5" checked> 3‚Äì5</label>
            <label><input type="radio" name="age" value=">5"> –°—Ç–∞—Ä—à–µ 5</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsEV" style="display:none">
        <div><label>–ú–æ—â–Ω–æ—Å—Ç—å (–∫–í—Ç): <input type="number" id="motorKw"></label></div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç</div>
          <div class="radio-line">
            <label><input type="radio" name="age_ev" value="<3" checked> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age_ev" value=">=3"> 3 –∏ —Å—Ç–∞—Ä—à–µ</label>
          </div>
        </div>
      </div>

      <!-- —Å–∫—Ä—ã—Ç–∞—è –¢–° -->
      <input type="hidden" id="__tsRubHidden">

      <div class="subpanel">
        <div class="grid">
          <div>–¶–µ–Ω–∞ –∞–≤—Ç–æ —Å –ø–æ—à–ª–∏–Ω–æ–π –∏ —Å–±–æ—Ä–∞–º–∏ (‚ÇΩ)</div>
          <input class="auto-output" id="priceWithDutyRub" readonly>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div>–ü–æ—à–ª–∏–Ω–∞ (‚ÇΩ) <span class="muted">(max –∏–∑ % –∏ ‚Ç¨/—Å–º¬≥)</span></div>     <input class="auto-output" id="autoDuty" readonly>
          <div>–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div>                                           <input class="auto-output" id="autoCustomsFee" readonly>
          <div>–£—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div>                                       <input class="auto-output" id="autoUtil" readonly>
          <div><strong>–ò—Ç–æ–≥–æ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã¬ª (‚ÇΩ)</strong></div>                  <input class="auto-output" id="autoTotalCustoms" readonly>
        </div>
      </div>
    </div>

    <label>–¢–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —É—Å–ª—É–≥–∏ –±—Ä–æ–∫–µ—Ä–∞ (‚ÇΩ): <input type="number" id="brokerRub" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 70000"></label>
    <label>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ (‚ÇΩ): <input type="number" id="deliveryRub" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 50000"></label>
  </div>

  <!-- –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ -->
  <button id="insuranceBtn" type="button" class="toggle-btn">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ 0,3%: –≤—ã–∫–ª</button>
  <input type="checkbox" id="insuranceCheck" hidden>

  <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è</button>

  <div class="result" id="result"></div>

  <!-- PDF ‚Äî –≤–Ω–∏–∑—É -->
  <button class="pdf" onclick="downloadPDF()">üìÑ –°–∫–∞—á–∞—Ç—å PDF-–æ—Ç—á—ë—Ç</button>
</main>

<script>
/* ===== —Å—Ç–∞–≤–∫–∏ (—Å–∂–∞—Ç—ã–µ, –Ω–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω—ã–µ) ===== */
const DUTY_INDIV = {
  "<3":[
    {min:0,max:1000,adval:0.48,spec:3.5},{min:1000,max:1500,adval:0.48,spec:3.5},
    {min:1500,max:1800,adval:0.48,spec:3.5},{min:1800,max:2000,adval:0.48,spec:3.5},
    {min:2000,max:3000,adval:0.15,spec:2.5},{min:3000,max:3500,adval:0.15,spec:2.7},{min:3500,max:1e9,adval:0.20,spec:3.0}
  ],
  "3-5":[
    {min:0,max:1000,adval:null,spec:1.5},{min:1000,max:1500,adval:null,spec:1.7},
    {min:1500,max:1800,adval:null,spec:2.5},{min:1800,max:2300,adval:null,spec:2.7},
    {min:2300,max:3000,adval:null,spec:3.0},{min:3000,max:3500,adval:null,spec:3.6},{min:3500,max:1e9,adval:null,spec:5.7}
  ],
  ">5":[
    {min:0,max:1000,adval:null,spec:3.0},{min:1000,max:1500,adval:null,spec:3.2},
    {min:1500,max:1800,adval:null,spec:3.5},{min:1800,max:2300,adval:null,spec:4.8},
    {min:2300,max:3000,adval:null,spec:5.0},{min:3000,max:3500,adval:null,spec:5.7},{min:3500,max:1e9,adval:null,spec:7.5}
  ]
};
const DUTY_BIZ = DUTY_INDIV;

const CUSTOMS_FEE = [
  {max:200000, fee:1071},
  {max:450000, fee:2142},
  {max:1200000, fee:4284},
  {max:2500000, fee:11746},   // –∫–∞–∫ –Ω–∞ —ç—Ç–∞–ª–æ–Ω–µ Drom
  {max:5000000, fee:20000},
  {max:10000000, fee:30000},
  {max:1e12, fee:30000}
];

/* ===== —É—Ç–∏–ª–∏—Ç—ã ===== */
const $=id=>document.getElementById(id);
const num=v=>(parseFloat(String(v).replace(/\s/g,'').replace(',','.')))||0;

function pickRow(tbl,age,cc){ return tbl[age].find(r=>cc>r.min && cc<=r.max); }
function dutyICE({table,age,cc,ts,eurRub}){ const r=pickRow(table,age,cc); const ad=r.adval?ts*r.adval:0; const sp=r.spec?cc*r.spec*eurRub:0; return Math.max(ad,sp); }
function dutyEV(ts){ return ts*0.15; }
function customsFee(ts){ return CUSTOMS_FEE.find(b=>ts<=b.max).fee; }
// —É—Ç–∏–ª—å (–ø–æ–¥ —Ç–≤–æ–π –∫–µ–π—Å —Ñ–∏–∑–ª–∏—Ü–æ 3‚Äì5 –ª–µ—Ç = 5200 ‚ÇΩ; –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω–æ)
function utilFee({importer,isEV,age,cc,kw}){
  if(importer==='individual' && !isEV && age==='3-5') return 5200;
  if(importer==='individual' && isEV) return age==='<3' ? 3400 : 5200;
  const base=(importer==='business')?(age==='<3'?200000:150000):(age==='<3'?20000:15000);
  const k = isEV ? (kw<=85?0.17:0.26) : (cc<=1000?0.17:(cc<=2000?0.34:(cc<=3000?0.43:(cc<=3500?0.86:1.34))));
  return Math.round(base*k);
}

/* ===== –∫—É—Ä—Å—ã ===== */
async function fetchCbr(){
  const r = await fetch('https://www.cbr-xml-daily.ru/daily_json.js', {cache:'no-store'});
  const d = await r.json();
  const EUR = d.Valute.EUR.Value / d.Valute.EUR.Nominal;
  const KRW = d.Valute.KRW.Value / d.Valute.KRW.Nominal;
  $('eurRub').value = EUR.toFixed(6);
  $('krwRub').value = KRW.toFixed(6);
  const dt = new Date(d.Date);
  $('cbrSrc').textContent = `–ö—É—Ä—Å—ã –¶–ë –†–§ –Ω–∞ ${dt.toLocaleDateString('ru-RU')}`;
}
async function fetchUsdt(){
  const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub,krw', {cache:'no-store'});
  const j = await r.json();
  $('rubUsdt').value = Number(j.tether.rub).toFixed(4);
  $('usdtKrw').value = Number(j.tether.krw).toFixed(2);
  const now = new Date().toLocaleString('ru-RU');
  $('usdtSrc').textContent  = `–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko ‚Ä¢ ${now}`;
  $('usdtSrc2').textContent = `–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko ‚Ä¢ ${now}`;
}

/* ===== —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UI ===== */
function engineType(){ return document.querySelector('input[name="eng"]:checked').value; }
function importer(){ return document.querySelector('input[name="importer"]:checked').value; }
function ageRaw(){
  return engineType()==='ev'
    ? document.querySelector('input[name="age_ev"]:checked').value
    : document.querySelector('input[name="age"]:checked').value;
}
function toggleEV(){
  const ev = engineType()==='ev';
  $('paramsICE').style.display = ev ? 'none' : 'flex';
  $('paramsEV').style.display  = ev ? 'flex' : 'none';
}

/* ===== –ø–µ—Ä–µ—Å—á—ë—Ç –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç–∞ –ø–æ—à–ª–∏–Ω ===== */
function recompute(){
  const eur=num($('eurRub').value), krw=num($('krwRub').value);
  const priceKrw=num($('priceKrw').value), expKrw=num($('expensesKrw').value);
  const ts = (priceKrw + expKrw) * krw; $('__tsRubHidden').value=Math.round(ts);

  const imp=importer(), ev=engineType()==='ev', age=ageRaw();
  let duty=0, util=0;
  if(ev){
    duty = dutyEV(ts);
    const kw=num($('motorKw').value);
    util = utilFee({importer:imp,isEV:true,age,kw});
  }else{
    const cc=num($('engineCc').value);
    const table=(imp==='business')?DUTY_BIZ:DUTY_INDIV;
    duty = dutyICE({table,age,cc,ts,eurRub:eur});
    util = utilFee({importer:imp,isEV:false,age,cc});
  }
  const fee=customsFee(ts);
  const total=Math.round(duty+fee+util);
  $('autoDuty').value=Math.round(duty);
  $('autoCustomsFee').value=Math.round(fee);
  $('autoUtil').value=Math.round(util);
  $('autoTotalCustoms').value=total;

  const carPriceRub = priceKrw * krw; // –¢–û–õ–¨–ö–û —Ü–µ–Ω–∞ –∞–≤—Ç–æ
  $('priceWithDutyRub').value = Math.round(carPriceRub + total);
}

/* ===== –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞—Å—á—ë—Ç ===== */
function calculate(){
  const rubUsdt=num($('rubUsdt').value), usdtKrw=num($('usdtKrw').value);
  const priceKrw=num($('priceKrw').value), expKrw=num($('expensesKrw').value);
  const autoTotal=num($('autoTotalCustoms').value), broker=num($('brokerRub').value), delivery=num($('deliveryRub').value);
  const insuranceOn=$('insuranceCheck').checked;

  const koreaKrw = priceKrw + expKrw;
  const rubNeeded = usdtKrw ? (koreaKrw/usdtKrw)*rubUsdt : 0;
  const russiaSubtotal = autoTotal + broker + delivery;
  const preFinal = rubNeeded + russiaSubtotal;
  const insurance = insuranceOn ? preFinal*0.003 : 0;
  const finalRub = preFinal + insurance;

  $('result').innerHTML = `
    <p>üí∞ –í –ö–æ—Ä–µ–µ: ${Math.round(rubNeeded).toLocaleString('ru-RU')} ‚ÇΩ</p>
    <p>üí∞ –í –†–æ—Å—Å–∏–∏: ${Math.round(russiaSubtotal).toLocaleString('ru-RU')} ‚ÇΩ</p>
    ${insuranceOn ? `<p>üõ°Ô∏è –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: ${Math.round(insurance).toLocaleString('ru-RU')} ‚ÇΩ</p>` : ''}
    <hr><p>üèÅ –ü–æ–¥ –∫–ª—é—á: <strong>${Math.round(finalRub).toLocaleString('ru-RU')} ‚ÇΩ</strong></p>`;
}

function clearAll(){
  document.querySelectorAll('input').forEach(i=>{
    if(i.type!=='radio' && i.type!=='checkbox') i.value='';
  });
  $('insuranceCheck').checked=false;
  const btn=$('insuranceBtn'); btn.classList.remove('active'); btn.textContent='–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ 0,3%: –≤—ã–∫–ª';
  $('result').innerHTML='';
  recompute();
}

/* ===== PDF ‚Äî –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á—ë—Ç, –≤–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ –æ–¥–∏–Ω –ª–∏—Å—Ç A4 ===== */
function fmt(n, d=0){
  if (!isFinite(n)) return '‚Äî';
  const v = d ? Number(n).toFixed(d) : Math.round(n);
  return Number(v).toLocaleString('ru-RU');
}
async function downloadPDF(){
  const n = v => (parseFloat(String(v ?? '').replace(/\s/g,'').replace(',','.')))||0;
  const val = id => n($(id)?.value);
  const insuranceOn = $('insuranceCheck').checked;

  const priceKrw    = val('priceKrw');
  const expensesKrw = val('expensesKrw');
  const rubUsdt     = val('rubUsdt');
  const usdtKrw     = val('usdtKrw');
  const eurRub      = val('eurRub');
  const krwRub      = val('krwRub');

  const autoDuty    = val('autoDuty');
  const autoCustomsFee = val('autoCustomsFee');
  const autoUtil    = val('autoUtil');
  const autoTotal   = val('autoTotalCustoms');
  const priceWithDutyRub = val('priceWithDutyRub');

  const brokerRub   = val('brokerRub');
  const deliveryRub = val('deliveryRub');

  const koreaKrw        = priceKrw + expensesKrw;
  const rubNeeded       = usdtKrw ? (koreaKrw / usdtKrw) * rubUsdt : 0;
  const russiaSubtotal  = autoTotal + brokerRub + deliveryRub;
  const preFinal        = rubNeeded + russiaSubtotal;
  const insuranceRub    = insuranceOn ? preFinal * 0.003 : 0;
  const finalRub        = preFinal + insuranceRub;

  // –°–æ–±–∏—Ä–∞–µ–º ¬´—á–∏—Å—Ç—É—é¬ª —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç—á—ë—Ç–∞
  const page = document.createElement('div');
  page.style.cssText = `
    position:fixed; left:-99999px; top:0; width:794px; /* A4 @96dpi */
    background:#fff; color:#000; font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
  `;
  const add = html => { const d=document.createElement('div'); d.innerHTML=html; page.appendChild(d); };

  add('<div style="height:10px;background:#000;width:100%"></div>');

  const hasLogo = await (async()=>{const t=new Image(); t.src='logo_pdf.png'; try{await new Promise(r=>{t.onload=r;t.onerror=r})}catch{} return (t.complete&&t.naturalWidth)?'logo_pdf.png':'logo.png';})();
  add(`
    <div style="display:flex;justify-content:space-between;align-items:flex-start;padding:18px 24px 0 24px;gap:16px;">
      <img src="${hasLogo}" alt="Harmex" style="height:90px;object-fit:contain">
      <div style="text-align:right; font-size:12px; line-height:1.5;">
        <strong style="font-size:14px">Harmex</strong><br>
        ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏: 749-11-02981<br>
        Tel: +82 10 3056 0903<br>
        Email: annamoloz95@gmail.com<br>
        Address: 201, 42 Hambak-ro84beon-gil,<br>
        Yeonsu-dong, Yeonsu-gu, Incheon, South Korea<br>
        Director: Molozhavaia Anna
      </div>
    </div>
    <div style="text-align:center; font-weight:700; font-size:20px; margin:16px 24px 4px;">–û—Ç—á—ë—Ç –ø–æ —Ä–∞—Å—á—ë—Ç—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏–∑ –ö–æ—Ä–µ–∏</div>
    <div style="text-align:center; font-size:12px; color:#222; margin-bottom:10px;">–î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}</div>
    <div style="height:1px;background:#000;margin:6px 24px 12px;"></div>
  `);

  add(`
    <div style="margin:0 24px 10px;">
      <div style="font-weight:700; margin:6px 0;">–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç</div>
      <table style="width:100%; border-collapse:collapse; font-size:14px;">
        <thead>
          <tr>
            <th style="text-align:left; border-bottom:2px solid #000; padding:8px 6px;">–ü–∞—Ä–∞</th>
            <th style="text-align:right; border-bottom:2px solid #000; padding:8px 6px;">–ö—É—Ä—Å</th>
          </tr>
        </thead>
        <tbody>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">1 USDT ‚Üí ‚ÇΩ</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(rubUsdt,4)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">1 USDT ‚Üí ‚Ç©</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(usdtKrw,2)} ‚Ç©</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">1 EUR ‚Üí ‚ÇΩ (–¶–ë)</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(eurRub,6)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px;">1 KRW ‚Üí ‚ÇΩ (–¶–ë)</td>
              <td style="padding:8px 6px; text-align:right;">${fmt(krwRub,6)} ‚ÇΩ</td></tr>
        </tbody>
      </table>
    </div>
  `);

  add(`
    <div style="margin:10px 24px;">
      <div style="font-weight:700; margin:6px 0;">–ö–æ—Ä–µ—è</div>
      <table style="width:100%; border-collapse:collapse; font-size:14px;">
        <tbody>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–¶–µ–Ω–∞ –∞–≤—Ç–æ (KRW)</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(priceKrw)} ‚Ç©</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:2px solid #000;">–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (KRW)</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;">${fmt(expensesKrw)} ‚Ç©</td></tr>
          <tr><td style="padding:8px 6px;"><strong>–°–∫–æ–ª—å–∫–æ —Ä—É–±–ª–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ USDT</strong></td>
              <td style="padding:8px 6px; text-align:right;"><strong>${fmt(rubNeeded)} ‚ÇΩ</strong></td></tr>
        </tbody>
      </table>
    </div>
  `);

  add(`
    <div style="margin:10px 24px;">
      <div style="font-weight:700; margin:6px 0;">–†–æ—Å—Å–∏—è</div>
      <table style="width:100%; border-collapse:collapse; font-size:14px;">
        <tbody>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–ü–æ—à–ª–∏–Ω–∞</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(autoDuty)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π —Å–±–æ—Ä</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(autoCustomsFee)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:2px solid #000;">–£—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;">${fmt(autoUtil)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px;"><strong>–ò—Ç–æ–≥–æ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã¬ª</strong></td>
              <td style="padding:8px 6px; text-align:right;"><strong>${fmt(autoTotal)} ‚ÇΩ</strong></td></tr>
          <tr><td style="padding:8px 6px;">–¶–µ–Ω–∞ –∞–≤—Ç–æ —Å –ø–æ—à–ª–∏–Ω–æ–π –∏ —Å–±–æ—Ä–∞–º–∏ (RUB)</td>
              <td style="padding:8px 6px; text-align:right;">${fmt(priceWithDutyRub)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px;">–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –±—Ä–æ–∫–µ—Ä</td>
              <td style="padding:8px 6px; text-align:right;">${fmt(brokerRub)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px; border-bottom:2px solid #000;">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏</td>
              <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;">${fmt(deliveryRub)} ‚ÇΩ</td></tr>
          <tr><td style="padding:8px 6px;"><strong>–ò—Ç–æ–≥–æ –ø–æ –†–æ—Å—Å–∏–∏</strong></td>
              <td style="padding:8px 6px; text-align:right;"><strong>${fmt(russiaSubtotal)} ‚ÇΩ</strong></td></tr>
        </tbody>
      </table>
    </div>
  `);

  if (insuranceOn){
    add(`
      <div style="margin:10px 24px;">
        <div style="font-weight:700; margin:6px 0;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</div>
        <table style="width:100%; border-collapse:collapse; font-size:14px;">
          <tbody>
            <tr><td style="padding:8px 6px; border-bottom:2px solid #000;">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ (0,3%)</td>
                <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;">${fmt(insuranceRub)} ‚ÇΩ</td></tr>
          </tbody>
        </table>
      </div>
    `);
  }

  add(`
    <div style="margin:12px 24px 0;">
      <div style="font-weight:700; margin:6px 0;">–ò—Ç–æ–≥</div>
      <table style="width:100%; border-collapse:collapse; font-size:15px;">
        <tbody>
          <tr>
            <td style="padding:10px 6px;"><strong>–ü–û–î –ö–õ–Æ–ß</strong></td>
            <td style="padding:10px 6px; text-align:right;"><strong>${fmt(finalRub)} ‚ÇΩ</strong></td>
          </tr>
        </tbody>
      </table>
      <div style="font-size:11px; color:#555; margin:12px 24px 18px;">–ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞—Å—á—ë—Ç–∞: https://grizar94-hash.github.io/AutoCalc/</div>
    </div>
  `);

  document.body.appendChild(page);

  // –†–µ–Ω–¥–µ—Ä ‚Üí –≤–ø–∏—Å—ã–≤–∞–µ–º –≤ –æ–¥–∏–Ω –ª–∏—Å—Ç A4
  const canvas = await html2canvas(page, { scale:2, useCORS:true });
  const imgData = canvas.toDataURL('image/png');

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','pt','a4'); // –ø–æ—Ä—Ç—Ä–µ—Ç A4

  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();

  const imgW = canvas.width;
  const imgH = canvas.height;

  const scale = Math.min(pageW / imgW, pageH / imgH); // —á—Ç–æ–±—ã –≤–ª–µ–∑–ª–æ –ø–æ –æ–±–æ–∏–º –∏–∑–º–µ—Ä–µ–Ω–∏—è–º
  const drawW = imgW * scale;
  const drawH = imgH * scale;
  const x = (pageW - drawW) / 2;
  const y = (pageH - drawH) / 2;

  pdf.addImage(imgData, 'PNG', x, y, drawW, drawH);
  pdf.save('AutoCalc_Report.pdf');

  document.body.removeChild(page);
}

/* ===== init ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  fetchUsdt(); fetchCbr();

  const btn=$('insuranceBtn'), chk=$('insuranceCheck');
  btn.addEventListener('click', ()=>{
    btn.classList.toggle('active');
    const on = btn.classList.contains('active');
    btn.textContent = `–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ 0,3%: ${on?'–≤–∫–ª':'–≤—ã–∫–ª'}`;
    chk.checked = on;
  });

  document.querySelectorAll('input').forEach(el=>{
    if(el.type!=='radio' && el.type!=='checkbox') el.addEventListener('input', recompute);
  });
  document.querySelectorAll('input[name="importer"],input[name="eng"],input[name="age"],input[name="age_ev"]')
    .forEach(el=>el.addEventListener('change', ()=>{ toggleEV(); recompute(); }));

  toggleEV(); recompute();
});
</script>
</body>
</html>
