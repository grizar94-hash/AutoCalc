<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</title>

<!-- Open Graph -->
<meta property="og:type" content="website" />
<meta property="og:title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏" />
<meta property="og:description" content="–†–∞—Å—Å—á–∏—Ç–∞–π –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å ¬´–ø–æ–¥ –∫–ª—é—á¬ª –≤ —Ä—É–±–ª—è—Ö –∏ USDT." />
<meta property="og:url" content="https://grizar94-hash.github.io/AutoCalc/" />
<meta property="og:image" content="https://grizar94-hash.github.io/AutoCalc/share.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />

<link rel="icon" href="icon.png" type="image/png" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="manifest" href="manifest.json" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

<!-- jsPDF + html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root { --blue:#0b69ff; --bg:#f0f2f5; --shadow:0 4px 10px rgba(0,0,0,.1); }
  *{ box-sizing:border-box }
  body{
    font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
    background:var(--bg); color:#111; margin:0; padding:20px; overflow-x:hidden;
  }
  .wrap{ max-width:720px; margin:0 auto; }
  h2{ text-align:center; color:var(--blue); margin:0 0 20px; }
  .section{
    padding:20px; margin-bottom:15px; border-radius:12px; color:#fff;
    box-shadow:var(--shadow); transition:background .3s;
  }
  .korea{ background:#4fc3f7 } .currency{ background:#26a69a } .russia{ background:#81c784 }
  .section h3{ margin:0 0 6px }
  .section label{ display:block; margin-top:10px; font-weight:700 }
  input, select{
    width:100%; padding:10px; margin-top:6px; border-radius:8px; border:none; font-size:16px;
  }
  .row{ display:flex; gap:10px; flex-wrap:wrap }
  .row > div { flex:1 1 200px }
  .subpanel{
    margin-top:12px; background:#f7f7f8; border:1px solid #e5e7eb; border-radius:10px;
    padding:12px; color:#111;
  }
  .subpanel h4{ margin:0 0 8px; font-size:16px; color:#0f172a }
  .note{ font-size:12px; color:#475569; margin-top:4px }
  .chip{
    display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
    background:#eef2ff; color:#334155; font-weight:700; font-size:12px; margin-right:8px
  }
  .muted{ color:#64748b; font-weight:600; font-size:12px }
  .tag{ font-size:12px; color:#111; background:#fff3cd; border:1px dashed #f59e0b; padding:2px 6px; border-radius:6px }
  .auto-output{ background:#fff8e1 } /* –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç ‚Äî –Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ */

  .insurance-row{
    display:flex; align-items:center; gap:10px;
    margin:12px 0 4px; background:#f7f7f8; border:1px solid #e5e7eb;
    border-radius:10px; padding:10px 12px; box-shadow:var(--shadow); color:#111;
  }
  .insurance-row input{ width:20px; height:20px }
  .insurance-row label{ flex:1; font-weight:600; line-height:1.3 }
  button{
    width:100%; padding:14px; margin-top:15px; font-size:18px; border:none; border-radius:10px;
    cursor:pointer; background:var(--blue); color:#fff; font-weight:700; transition:.2s; box-shadow:var(--shadow);
  }
  button:hover{ background:#0756d1 }
  button.clear{ background:#ccc; color:#111 }
  button.pdf{ background:#0b69ff; color:#fff }

  .result{
    margin-top:20px; padding:20px; border-radius:12px; background:#fff3e0; font-size:18px; box-shadow:var(--shadow);
  }
  .result p{ margin:10px 0; font-weight:700 }
  hr{ border:0; border-top:2px dashed #ccc; margin:10px 0 }
  .radio-line{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
  .radio-line label{ font-weight:600; color:#111; background:#e2e8f0; padding:6px 10px; border-radius:8px; cursor:pointer }
  .radio-line input{ width:auto; margin-right:6px }
  .right{ text-align:right }
  .grid{ display:grid; grid-template-columns: 1fr auto; gap:8px 10px; align-items:center }
</style>
</head>
<body>
<main class="wrap">

  <h2>üöó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</h2>

  <div class="section korea" id="blockKorea">
    <h3>üá∞üá∑ –ö–æ—Ä–µ—è</h3>
    <label>–¶–µ–Ω–∞ –∞–≤—Ç–æ (‚Ç©): <input type="number" id="priceKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∞–≤—Ç–æ"></label>
    <label>–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (‚Ç©): <input type="number" id="expensesKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã"></label>
    <div class="note">–°—É–º–º–∞ –≤ –ö–æ—Ä–µ–µ –¥–∞–ª–µ–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞ –≤ —Ä—É–±–ª–∏ —á–µ—Ä–µ–∑ USDT (USDT‚Üí‚Ç© –∏ USDT‚Üí‚ÇΩ)</div>
  </div>

  <div class="section currency" id="blockCurrency">
    <h3>üí± –ö—É—Ä—Å –≤–∞–ª—é—Ç</h3>
    <div class="row">
      <div>
        <label>USDT ‚Üí ‚ÇΩ:
          <input type="number" id="rubUsdt" placeholder="–°–∫–æ–ª—å–∫–æ —Ä—É–±–ª–µ–π –∑–∞ 1 USDT" step="0.0001">
        </label>
      </div>
      <div>
        <label>USDT ‚Üí ‚Ç©:
          <input type="number" id="usdtKrw" placeholder="–°–∫–æ–ª—å–∫–æ –≤–æ–Ω –∑–∞ 1 USDT" step="0.01">
        </label>
      </div>
    </div>
    <div class="note">
      <span class="chip">Binance/Coingecko</span> –ê–≤—Ç–æ–ø–æ–¥–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ ‚Ä¢ –ú–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
    </div>
  </div>

  <div class="section russia" id="blockRussia">
    <h3>üá∑üá∫ –†–æ—Å—Å–∏—è</h3>

    <!-- === –ü–æ–ª–µ, –∫–∞–∫ –±—ã–ª–æ —É —Ç–µ–±—è: —Å—é–¥–∞ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç, –Ω–æ –ø–æ–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ === -->
    <label>–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã (‚ÇΩ):
      <input type="number" id="dutyRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 150000">
    </label>

    <!-- === –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –∏ —Å–±–æ—Ä–æ–≤ === -->
    <div class="subpanel" id="autoCustoms">
      <h4>‚öôÔ∏è –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –∏ —Å–±–æ—Ä–æ–≤</h4>

      <div class="row">
        <div>
          <div class="muted">–¢–∏–ø –≤–≤–æ–∑—è—â–µ–≥–æ</div>
          <div class="radio-line" id="importerType">
            <label><input type="radio" name="importer" value="individual" checked> –§–∏–∑–ª–∏—Ü–æ</label>
            <label><input type="radio" name="importer" value="business"> –Æ—Ä–ª–∏—Ü–æ / –ò–ü</label>
          </div>
        </div>
        <div>
          <div class="muted">–¢–∏–ø –¥–≤–∏–≥–∞—Ç–µ–ª—è</div>
          <div class="radio-line" id="engineType">
            <label><input type="radio" name="eng" value="ice" checked> –î–í–°</label>
            <label><input type="radio" name="eng" value="ev"> –≠–ª–µ–∫—Ç—Ä–æ</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsICE">
        <div>
          <label>–û–±—ä—ë–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (—Å–º¬≥):
            <input type="number" id="engineCc" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 2000">
          </label>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)</div>
          <div class="radio-line" id="ageGroup">
            <label><input type="radio" name="age" value="<3" checked> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age" value="3-5"> 3‚Äì5</label>
            <label><input type="radio" name="age" value=">5"> –°—Ç–∞—Ä—à–µ 5</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsEV" style="display:none">
        <div>
          <label>–ú–æ—â–Ω–æ—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–¥–≤–∏–≥–∞—Ç–µ–ª—è (–∫–í—Ç):
            <input type="number" id="motorKw" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 100">
          </label>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)</div>
          <div class="radio-line" id="ageGroupEV">
            <label><input type="radio" name="age_ev" value="<3" checked> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age_ev" value=">=3"> 3 –∏ —Å—Ç–∞—Ä—à–µ</label>
          </div>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div class="muted">–ö—É—Ä—Å EUR ‚Üí ‚ÇΩ (–¶–ë)</div>
          <input class="auto-output" id="eurRub" placeholder="–∞–≤—Ç–æ">
          <div class="muted">–ö—É—Ä—Å KRW ‚Üí ‚ÇΩ (–¶–ë)</div>
          <input class="auto-output" id="krwRub" placeholder="–∞–≤—Ç–æ">
        </div>
        <div class="note">–ö—É—Ä—Å—ã –¶–ë –Ω—É–∂–Ω—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ ‚Ç¨/—Å–º¬≥. –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é.</div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div>–¢–∞–º–æ–∂–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–¢–°), ‚ÇΩ <span class="tag">–∏–∑ KRW —á–µ—Ä–µ–∑ –¶–ë</span></div>
          <input class="auto-output" type="number" id="customsValueRub" placeholder="–∞–≤—Ç–æ">
          <div class="muted">–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.</div>
          <div></div>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div>–ü–æ—à–ª–∏–Ω–∞ (‚ÇΩ) <span class="muted">(–±–µ—Ä—ë–º –±–æ–ª—å—à–µ–µ –∏–∑ % –∏ ‚Ç¨/—Å–º¬≥)</span></div>
          <input class="auto-output" type="number" id="autoDuty" placeholder="–∞–≤—Ç–æ">
          <div>–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div>
          <input class="auto-output" type="number" id="autoCustomsFee" placeholder="–∞–≤—Ç–æ">
          <div>–£—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div>
          <input class="auto-output" type="number" id="autoUtil" placeholder="–∞–≤—Ç–æ">
          <div><strong>–ò—Ç–æ–≥–æ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã¬ª (‚ÇΩ)</strong></div>
          <input class="auto-output" type="number" id="autoTotalCustoms" placeholder="–∞–≤—Ç–æ">
        </div>
        <div class="note">–ò—Ç–æ–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã (‚ÇΩ)¬ª –≤—ã—à–µ ‚Äî –Ω–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é.</div>
      </div>
    </div>

    <label>–¢–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —É—Å–ª—É–≥–∏ –±—Ä–æ–∫–µ—Ä–∞ (‚ÇΩ): <input type="number" id="brokerRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 70000"></label>
    <label>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ (‚ÇΩ): <input type="number" id="deliveryRub" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 50000"></label>
  </div>

  <div class="insurance-row">
    <input type="checkbox" id="insuranceCheck" />
    <label for="insuranceCheck">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É 0,3% –æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—É–º–º—ã</label>
  </div>

  <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è</button>
  <button class="pdf" onclick="downloadPDF()">üìÑ –°–∫–∞—á–∞—Ç—å PDF-–æ—Ç—á—ë—Ç</button>

  <div class="result" id="result"></div>
</main>

<script>
/* ======================= –ö–û–ù–°–¢–ê–ù–¢–´ –°–¢–ê–í–û–ö ======================= */
/* –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–∏ —Ü–∏—Ñ—Ä—ã –ø–æ–¥ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã. */

// –ü–æ—à–ª–∏–Ω—ã (–î–í–°) ‚Äî –≤—ã–±–æ—Ä max(–∞–¥–≤–∞–ª–æ—Ä %, ‚Ç¨/—Å–º¬≥)
// –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –§–ò–ó–õ–ò–¶ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞; –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã)
const DUTY_TABLE_INDIVIDUAL = {
  "<3": [
    { min: 0,    max: 1000,  adval: 0.48, specEurPerCc: 3.5 },
    { min: 1000, max: 1500,  adval: 0.48, specEurPerCc: 3.5 },
    { min: 1500, max: 1800,  adval: 0.48, specEurPerCc: 3.5 },
    { min: 1800, max: 2000,  adval: 0.48, specEurPerCc: 3.5 },
    { min: 2000, max: 3000,  adval: 0.15, specEurPerCc: 2.5 },
    { min: 3000, max: 3500,  adval: 0.15, specEurPerCc: 2.7 },
    { min: 3500, max: Infinity, adval: 0.20, specEurPerCc: 3.0 },
  ],
  "3-5": [
    { min: 0,    max: 1000,  adval: null, specEurPerCc: 1.5 },
    { min: 1000, max: 1500,  adval: null, specEurPerCc: 1.7 },
    { min: 1500, max: 1800,  adval: null, specEurPerCc: 2.5 },
    { min: 1800, max: 2300,  adval: null, specEurPerCc: 2.7 },
    { min: 2300, max: 3000,  adval: null, specEurPerCc: 3.0 },
    { min: 3000, max: 3500,  adval: null, specEurPerCc: 3.6 },
    { min: 3500, max: Infinity, adval: null, specEurPerCc: 5.7 },
  ],
  ">5": [
    { min: 0,    max: 1000,  adval: null, specEurPerCc: 3.0 },
    { min: 1000, max: 1500,  adval: null, specEurPerCc: 3.2 },
    { min: 1500, max: 1800,  adval: null, specEurPerCc: 3.5 },
    { min: 1800, max: 2300,  adval: null, specEurPerCc: 4.8 },
    { min: 2300, max: 3000,  adval: null, specEurPerCc: 5.0 },
    { min: 3000, max: 3500,  adval: null, specEurPerCc: 5.7 },
    { min: 3500, max: Infinity, adval: null, specEurPerCc: 7.5 },
  ],
};

// –ü–æ—à–ª–∏–Ω—ã (–î–í–°) –¥–ª—è –Æ–†–õ–ò–¶/–ò–ü ‚Äî —á–∞—Å—Ç–æ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –∞–¥–≤–∞–ª–æ—Ä–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏;
// –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –±–µ—Ä—ë–º —Ç—É –∂–µ —Å–µ—Ç–∫—É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –∏ —á—É—Ç—å –±–æ–ª–µ–µ ¬´–∂—ë—Å—Ç–∫–∏–µ¬ª –ø—Ä–æ—Ü–µ–Ω—Ç—ã.
const DUTY_TABLE_BUSINESS = {
  "<3": [
    { min: 0,    max: 1000,  adval: 0.54, specEurPerCc: 3.5 },
    { min: 1000, max: 1500,  adval: 0.54, specEurPerCc: 3.5 },
    { min: 1500, max: 1800,  adval: 0.54, specEurPerCc: 3.5 },
    { min: 1800, max: 2000,  adval: 0.54, specEurPerCc: 3.5 },
    { min: 2000, max: 3000,  adval: 0.20, specEurPerCc: 2.5 },
    { min: 3000, max: 3500,  adval: 0.20, specEurPerCc: 2.7 },
    { min: 3500, max: Infinity, adval: 0.30, specEurPerCc: 3.0 },
  ],
  "3-5": DUTY_TABLE_INDIVIDUAL["3-5"],
  ">5":  DUTY_TABLE_INDIVIDUAL[">5"],
};

// –¢–∞–º–æ–∂–µ–Ω–Ω—ã–π —Å–±–æ—Ä (–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ) ‚Äî —Å—Ç—É–ø–µ–Ω–∏ –ø–æ —Ç–∞–º–æ–∂–µ–Ω–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
const CUSTOMS_FEE_BRACKETS = [
  { max: 200_000,   fee: 500 },
  { max: 450_000,   fee: 1_000 },
  { max: 1_200_000, fee: 2_000 },
  { max: 2_500_000, fee: 5_500 },
  { max: 5_000_000, fee: 7_500 },
  { max: 10_000_000, fee: 20_000 },
  { max: Infinity,  fee: 30_000 },
];

// –£—Ç–∏–ª—å—Å–±–æ—Ä ‚Äî –±–∞–∑—ã –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
const UTIL_BASE = {
  individual: { "<3": 20_000, ">=3": 15_000 },
  business:   { "<3": 200_000, ">=3": 150_000 }, // –¥–ª—è —é—Ä–ª–∏—Ü/–ò–ü —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã—à–µ
};

const UTIL_COEFF_ICE = {
  "<3": [
    { max: 1000,  k: 0.17 },
    { max: 2000,  k: 0.34 },
    { max: 3000,  k: 0.43 },
    { max: 3500,  k: 0.86 },
    { max: Infinity, k: 1.34 },
  ],
  ">=3": [
    { max: 1000,  k: 0.26 },
    { max: 2000,  k: 0.53 },
    { max: 3000,  k: 0.86 },
    { max: 3500,  k: 1.30 },
    { max: Infinity, k: 2.00 },
  ],
};

// EV ‚Äî –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏ (–∫–í—Ç). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π –ø–æ–¥ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º—ã.
const UTIL_COEFF_EV = {
  "<3": [
    { max: 85,  k: 0.17 },
    { max: Infinity, k: 0.26 },
  ],
  ">=3": [
    { max: 85,  k: 0.26 },
    { max: Infinity, k: 0.43 },
  ],
};

// –ü–æ—à–ª–∏–Ω—ã –¥–ª—è EV: —á–∞—Å—Ç–æ –∞–¥–≤–∞–ª–æ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞. –û—Å—Ç–∞–≤–∏–º 15% –∫–∞–∫ –¥–µ—Ñ–æ–ª—Ç.
const EV_ADVAL_RATE = 0.15;

/* ======================= –£–¢–ò–õ–ò–¢–´ ======================= */
const sel = id => document.getElementById(id);

function pickRow(table, age, cc){
  const rows = table[age];
  return rows.find(r => cc > (r.min ?? -Infinity) && cc <= (r.max ?? Infinity));
}
function calcCustomsFee(ts){
  return CUSTOMS_FEE_BRACKETS.find(b => ts <= b.max).fee;
}
function calcUtil({ importer, isEV, ageKey, cc, kw }){
  const base = UTIL_BASE[importer][ageKey];
  const table = isEV ? UTIL_COEFF_EV[ageKey] : UTIL_COEFF_ICE[ageKey];
  const metric = isEV ? (kw||0) : (cc||0);
  const k = table.find(r => metric <= r.max).k;
  return base * k;
}
function calcDutyICE({ importer, ageRaw, cc, tsRub, eurRub }){
  const age = ageRaw; // "<3" | "3-5" | ">5"
  const table = importer === 'business' ? DUTY_TABLE_BUSINESS : DUTY_TABLE_INDIVIDUAL;
  const row = pickRow(table, age, cc);
  const adval = (row.adval != null) ? tsRub * row.adval : 0;
  const spec  = (row.specEurPerCc != null) ? cc * row.specEurPerCc * eurRub : 0;
  return Math.max(adval, spec);
}
function calcDutyEV({ tsRub }){
  return tsRub * EV_ADVAL_RATE; // –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–º–µ–Ω–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –ª—å–≥–æ—Ç—É/0%
}

/* ======================= –ö–£–†–°–´ ======================= */
const CACHE = {
  cbr: null,
  usdt: null
};

async function fetchCbrRates(){
  if (CACHE.cbr) return CACHE.cbr;
  const res = await fetch('https://www.cbr-xml-daily.ru/daily_json.js', { cache:'no-store' });
  const data = await res.json();
  const v = data.Valute;
  const rates = {
    USD: v.USD?.Value / v.USD?.Nominal,
    EUR: v.EUR?.Value / v.EUR?.Nominal,
    KRW: v.KRW?.Value / v.KRW?.Nominal,
    _date: data.Date
  };
  CACHE.cbr = rates;
  return rates;
}
async function fetchUsdtRates(){
  if (CACHE.usdt) return CACHE.usdt;
  const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub,krw,usd', { cache:'no-store' });
  const j = await res.json();
  const data = {
    USDT_RUB: j.tether.rub,
    USDT_KRW: j.tether.krw,
    USDT_USD: j.tether.usd
  };
  CACHE.usdt = data;
  return data;
}

/* ======================= –ê–í–¢–û–ü–û–î–ì–†–£–ó–ö–ê –ö–£–†–°–û–í –í UI ======================= */
async function initRates(){
  try{
    const [usdt, cbr] = await Promise.all([fetchUsdtRates(), fetchCbrRates()]);

    // –ï—Å–ª–∏ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ–º; –µ—Å–ª–∏ —É–∂–µ –≤–≤–µ–¥–µ–Ω—ã ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å.
    if (!sel('rubUsdt').value) sel('rubUsdt').value = Number(usdt.USDT_RUB).toFixed(6);
    if (!sel('usdtKrw').value) sel('usdtKrw').value = Number(usdt.USDT_KRW).toFixed(2);

    if (!sel('eurRub').value) sel('eurRub').value = Number(cbr.EUR).toFixed(6);
    if (!sel('krwRub').value) sel('krwRub').value = Number(cbr.KRW).toFixed(6);

    // –ü–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç —Ç–∞–º–æ–∂–Ω–∏ –ø–æ —Å–≤–µ–∂–∏–º –∫—É—Ä—Å–∞–º
    autoCustomsRecalc();
  }catch(e){
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É—Ä—Å—ã:', e);
  }
}

/* ======================= –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ê–°–ß–Å–¢–ê –¢–ê–ú–û–ñ–ù–ò ======================= */
function getImporter(){ return document.querySelector('input[name="importer"]:checked').value; }
function getEngineType(){ return document.querySelector('input[name="eng"]:checked').value; }
function getAge(){
  return (getEngineType() === 'ev')
    ? document.querySelector('input[name="age_ev"]:checked').value   // "<3" | ">=3"
    : document.querySelector('input[name="age"]:checked').value;     // "<3" | "3-5" | ">5"
}
function ageToKeyForUtil(ageRaw){
  return (ageRaw === "<3") ? "<3" : ">=3"; // –¥–ª—è —É—Ç–∏–ª—å—Å–±–æ—Ä–∞ —Ç–∞–±–ª–∏—Ü–∞ –±–∏–Ω–∞—Ä–Ω–∞—è
}

// –¢–∞–º–æ–∂–µ–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ—Ä—ë–º –∏–∑ KRW ‚Üí RUB –ø–æ –¶–ë
function computeTSbyDefault(){
  const priceKrw=+sel('priceKrw').value||0;
  const expensesKrw=+sel('expensesKrw').value||0;
  const krwRub = +sel('krwRub').value || 0;
  const totalKrw = priceKrw + expensesKrw;
  return totalKrw * krwRub;
}

function autoCustomsRecalc(){
  // –ö—É—Ä—Å—ã
  const eurRub = +sel('eurRub').value || 0;

  // –¢–° ‚Äî –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç –∏–∑ –ö–æ—Ä–µ–∏/–¶–ë
  let tsRub = +sel('customsValueRub').value || 0;
  if (!tsRub){
    tsRub = computeTSbyDefault();
    sel('customsValueRub').value = Math.round(tsRub);
  }

  const importer = getImporter(); // individual | business
  const isEV = (getEngineType() === 'ev');
  const ageRaw = getAge();
  const ageKey = ageToKeyForUtil(ageRaw);

  let duty = 0;
  let util = 0;

  if (isEV){
    const kw = +sel('motorKw').value || 0;
    duty = calcDutyEV({ tsRub });
    util = calcUtil({ importer, isEV:true, ageKey, kw });
  } else {
    const cc = +sel('engineCc').value || 0;
    duty = calcDutyICE({ importer, ageRaw, cc, tsRub, eurRub });
    util = calcUtil({ importer, isEV:false, ageKey, cc });
  }

  const customs_fee = calcCustomsFee(tsRub);
  const totalCustoms = Math.round(duty + customs_fee + util);

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è (–∞–≤—Ç–æ–∑–Ω–∞—á–µ–Ω–∏—è)
  sel('autoDuty').value = Math.round(duty);
  sel('autoCustomsFee').value = Math.round(customs_fee);
  sel('autoUtil').value = Math.round(util);
  sel('autoTotalCustoms').value = totalCustoms;

  // –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã (‚ÇΩ)¬ª, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å
  sel('dutyRub').value = totalCustoms;
}

/* ====== –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –î–í–° / –≠–ª–µ–∫—Ç—Ä–æ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è ====== */
function toggleEngineUI(){
  const isEV = (getEngineType() === 'ev');
  sel('paramsICE').style.display = isEV ? 'none' : 'flex';
  sel('paramsEV').style.display  = isEV ? 'flex' : 'none';
  autoCustomsRecalc();
}

/* ======================= –û–°–ù–û–í–ù–û–ô –†–ê–°–ß–Å–¢ ¬´–ü–û–î –ö–õ–Æ–ß¬ª ======================= */
function animateValue(id, start, end, duration){
  const el=document.getElementById(id); const rng=end-start; let t0=null;
  function step(ts){ if(!t0) t0=ts; const p=Math.min(1,(ts-t0)/duration);
    const v=Math.floor(start + rng*p);
    el.textContent = v.toLocaleString('ru-RU') + ' ‚ÇΩ';
    if(p<1) requestAnimationFrame(step); else el.textContent = end.toLocaleString('ru-RU') + ' ‚ÇΩ';
  }
  requestAnimationFrame(step);
}

async function calculate(){
  const priceKrw=+sel('priceKrw').value||0;
  const expensesKrw=+sel('expensesKrw').value||0;
  const rubUsdt=+sel('rubUsdt').value||0;
  const usdtKrw=+sel('usdtKrw').value||0;

  // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä—É–∫–∞–º–∏ –ø–µ—Ä–µ–ø–∏—Å–∞–ª ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã¬ª ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ, —á—Ç–æ –≤ –ø–æ–ª–µ.
  // –∏–Ω–∞—á–µ ‚Äî –≤–æ–∑—å–º—ë–º –∏–∑ –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç–∞ (autoTotalCustoms)
  let dutyRub = +sel('dutyRub').value || 0;
  const autoTotal = +sel('autoTotalCustoms').value || 0;
  if (!dutyRub && autoTotal) dutyRub = autoTotal;

  const brokerRub=+sel('brokerRub').value||0;
  const deliveryRub=+sel('deliveryRub').value||0;
  const insuranceOn=sel('insuranceCheck').checked;

  const koreaKrw = priceKrw + expensesKrw;
  const rubNeeded = usdtKrw ? (koreaKrw / usdtKrw) * rubUsdt : 0;
  const russiaSubtotal = dutyRub + brokerRub + deliveryRub;
  const preFinal = rubNeeded + russiaSubtotal;
  const insuranceRub = insuranceOn ? preFinal*0.003 : 0;
  const finalRub = preFinal + insuranceRub;

  sel('blockKorea').style.background='#29b6f6';
  sel('blockRussia').style.background='#66bb6a';
  sel('result').style.background='#ffe0b2';

  sel('result').innerHTML = `
    <p>üí∞ –í –ö–æ—Ä–µ–µ: <span id="valKorea">0 ‚ÇΩ</span></p>
    <p>üí∞ –í –†–æ—Å—Å–∏–∏: <span id="valRussia">0 ‚ÇΩ</span></p>
    ${insuranceOn ? `<p>üõ°Ô∏è –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: <span id="valInsurance">0 ‚ÇΩ</span></p>` : ''}
    <hr>
    <p>üèÅ –ü–æ–¥ –∫–ª—é—á: <span id="valFinal">0 ‚ÇΩ</span></p>
  `;
  animateValue('valKorea',0,Math.round(rubNeeded),900);
  animateValue('valRussia',0,Math.round(russiaSubtotal),900);
  if(insuranceOn) animateValue('valInsurance',0,Math.round(insuranceRub),900);
  animateValue('valFinal',0,Math.round(finalRub),1100);

  window.__calc = { priceKrw, expensesKrw, rubUsdt, usdtKrw, dutyRub, brokerRub, deliveryRub,
                    insuranceOn, koreaKrw, rubNeeded, russiaSubtotal, insuranceRub, finalRub };
}

function clearAll(){
  ['priceKrw','expensesKrw','rubUsdt','usdtKrw','dutyRub','brokerRub','deliveryRub',
   'engineCc','motorKw','customsValueRub','autoDuty','autoCustomsFee','autoUtil','autoTotalCustoms',
   'eurRub','krwRub'
  ].forEach(id=>{ const el = sel(id); if (el) el.value=''; });
  document.querySelector('input[name="importer"][value="individual"]').checked = true;
  document.querySelector('input[name="eng"][value="ice"]').checked = true;
  document.querySelector('input[name="age"][value="<3"]').checked = true;
  document.querySelector('input[name="age_ev"][value="<3"]').checked = true;

  sel('insuranceCheck').checked=false;
  sel('result').innerHTML='';
  sel('blockKorea').style.background='#4fc3f7';
  sel('blockRussia').style.background='#81c784';
  toggleEngineUI();
  window.__calc = null;
  initRates(); // –∑–∞–Ω–æ–≤–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å –∫—É—Ä—Å—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
}

/* ======================= PDF (–∫–∞–∫ –±—ã–ª–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ) ======================= */
function fmt(n, d=0){
  if (!isFinite(n)) return '‚Äî';
  const v = d ? Number(n).toFixed(d) : Math.round(n);
  return Number(v).toLocaleString('ru-RU');
}

async function downloadPDF(){
  const val = id => +(sel(id)?.value || 0);
  const insuranceOn = sel('insuranceCheck').checked;

  const priceKrw    = val('priceKrw');
  const expensesKrw = val('expensesKrw');
  const rubUsdt     = val('rubUsdt');
  const usdtKrw     = val('usdtKrw');
  const dutyRub     = (val('dutyRub') || val('autoTotalCustoms'));
  const brokerRub   = val('brokerRub');
  const deliveryRub = val('deliveryRub');

  const koreaKrw        = priceKrw + expensesKrw;
  const rubNeeded       = usdtKrw ? (koreaKrw / usdtKrw) * rubUsdt : 0;
  const russiaSubtotal  = dutyRub + brokerRub + deliveryRub;
  const preFinal        = rubNeeded + russiaSubtotal;
  const insuranceRub    = insuranceOn ? preFinal * 0.003 : 0;
  const finalRub        = preFinal + insuranceRub;

  const page = document.createElement('div');
  page.style.cssText = `
    position:fixed; left:-99999px; top:0; width:794px; background:#fff; color:#000;
    font-family:-apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
  `;
  const topBar = document.createElement('div'); topBar.style.cssText='height:10px;background:#000;width:100%;'; page.appendChild(topBar);

  const header = document.createElement('div');
  header.style.cssText = 'display:flex;justify-content:space-between;align-items:flex-start;padding:18px 24px 0 24px;gap:16px;';
  const logo = document.createElement('img'); const tryLarge = new Image();
  tryLarge.src = 'logo_pdf.png';
  await new Promise(r => { tryLarge.onload = r; tryLarge.onerror = r; });
  logo.src = (tryLarge.complete && tryLarge.naturalWidth) ? 'logo_pdf.png' : 'logo.png';
  logo.alt = 'Harmex'; logo.style.cssText = 'height:90px;object-fit:contain;'; header.appendChild(logo);
  const contacts = document.createElement('div');
  contacts.style.cssText = 'text-align:right; font-size:12px; line-height:1.5;';
  contacts.innerHTML = `
    <strong style="font-size:14px">Harmex</strong><br>
    ÏÇ¨ÏóÖÏûêÎì±Î°ùÎ≤àÌò∏: 749-11-02981<br>
    Tel: +82 10 3056 0903<br>
    Email: annamoloz95@gmail.com<br>
    Address: 201, 42 Hambak-ro84beon-gil,<br>
    &nbsp;&nbsp;&nbsp;&nbsp;Yeonsu-dong, Yeonsu-gu, Incheon, South Korea<br>
    Director: Molozhavaia Anna
  `;
  header.appendChild(contacts); page.appendChild(header);

  const title = document.createElement('div');
  title.textContent = '–û—Ç—á—ë—Ç –ø–æ —Ä–∞—Å—á—ë—Ç—É –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏–∑ –ö–æ—Ä–µ–∏';
  title.style.cssText = 'text-align:center; font-weight:700; font-size:20px; color:#000; margin:16px 24px 4px;';
  page.appendChild(title);

  const date = document.createElement('div');
  date.textContent = '–î–∞—Ç–∞: ' + new Date().toLocaleDateString('ru-RU');
  date.style.cssText = 'text-align:center; font-size:12px; color:#222; margin-bottom:10px;';
  page.appendChild(date);

  const hr = document.createElement('div'); hr.style.cssText = 'height:1px;background:#000;margin:6px 24px 12px;'; page.appendChild(hr);

  const rates = document.createElement('div'); rates.style.cssText = 'margin:0 24px 10px;';
  rates.innerHTML = `
    <div style="font-weight:700; margin:6px 0;">–ö—É—Ä—Å—ã –≤–∞–ª—é—Ç</div>
    <table style="width:100%; border-collapse:collapse; font-size:14px;">
      <thead>
        <tr>
          <th style="text-align:left; border-bottom:2px solid #000; padding:8px 6px;">–ü–∞—Ä–∞</th>
          <th style="text-align:right; border-bottom:2px solid #000; padding:8px 6px;">–ö—É—Ä—Å</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">1 USDT ‚Üí ‚ÇΩ</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(rubUsdt,4)} ‚ÇΩ</td></tr>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">1 USDT ‚Üí ‚Ç©</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(usdtKrw,2)} ‚Ç©</td></tr>
      </tbody>
    </table>
  `;
  page.appendChild(rates);

  const kor = document.createElement('div'); kor.style.cssText = 'margin:10px 24px;';
  kor.innerHTML = `
    <div style="font-weight:700; margin:6px 0;">–ö–æ—Ä–µ—è</div>
    <table style="width:100%; border-collapse:collapse; font-size:14px;">
      <tbody>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–¶–µ–Ω–∞ –∞–≤—Ç–æ (KRW)</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(priceKrw)} ‚Ç©</td></tr>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (KRW)</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(expensesKrw)} ‚Ç©</td></tr>
        <tr><td style="padding:8px 6px; border-bottom:2px solid #000;"><strong>–ò—Ç–æ–≥–æ –≤ –ö–æ—Ä–µ–µ (KRW)</strong></td>
            <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;"><strong>${fmt(koreaKrw)} ‚Ç©</strong></td></tr>
        <tr><td style="padding:8px 6px;"><strong>–°–∫–æ–ª—å–∫–æ —Ä—É–±–ª–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ USDT</strong></td>
            <td style="padding:8px 6px; text-align:right;"><strong>${fmt(rubNeeded)} ‚ÇΩ</strong></td></tr>
      </tbody>
    </table>
  `;
  page.appendChild(kor);

  const rus = document.createElement('div'); rus.style.cssText = 'margin:10px 24px;';
  rus.innerHTML = `
    <div style="font-weight:700; margin:6px 0;">–†–æ—Å—Å–∏—è</div>
    <table style="width:100%; border-collapse:collapse; font-size:14px;">
      <tbody>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã (RUB)</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(dutyRub)} ‚ÇΩ</td></tr>
        <tr><td style="padding:8px 6px; border-bottom:1px solid #e5e7eb;">–¢–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —É—Å–ª—É–≥–∏ –±—Ä–æ–∫–µ—Ä–∞ (RUB)</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:1px solid #e5e7eb;">${fmt(brokerRub)} ‚ÇΩ</td></tr>
        <tr><td style="padding:8px 6px; border-bottom:2px solid #000;">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ (RUB)</td>
            <td style="padding:8px 6px; text-align:right; border-bottom:2px solid #000;">${fmt(deliveryRub)} ‚ÇΩ</td></tr>
        <tr><td style="padding:8px 6px;"><strong>–ò—Ç–æ–≥–æ –ø–æ –†–æ—Å—Å–∏–∏</strong></td>
            <td style="padding:8px 6px; text-align:right;"><strong>${fmt(russiaSubtotal)} ‚ÇΩ</strong></td></tr>
      </tbody>
    </table>
  `;
  page.appendChild(rus);

  const total = document.createElement('div'); total.style.cssText = 'margin:12px 24px 0;';
  total.innerHTML = `
    <div style="font-weight:700; margin:6px 0;">–ò—Ç–æ–≥</div>
    <table style="width:100%; border-collapse:collapse; font-size:15px;">
      <tbody>
        <tr>
          <td style="padding:10px 6px;"><strong>–ü–û–î –ö–õ–Æ–ß</strong></td>
          <td style="padding:10px 6px; text-align:right;"><strong>${fmt(finalRub)} ‚ÇΩ</strong></td>
        </tr>
      </tbody>
    </table>
  `;
  page.appendChild(total);

  const footer=document.createElement('div');
  footer.style.cssText='font-size:11px; color:#555; margin:16px 24px 24px;';
  footer.textContent='–ò—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞—Å—á—ë—Ç–∞: https://grizar94-hash.github.io/AutoCalc/';
  page.appendChild(footer);

  document.body.appendChild(page);
  const canvas = await html2canvas(page, { scale:2 });
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','pt','a4');
  const imgData = canvas.toDataURL('image/png');
  const pdfW = pdf.internal.pageSize.getWidth();
  const pdfH = canvas.height * (pdfW / canvas.width);
  pdf.addImage(imgData, 'PNG', 0, 0, pdfW, pdfH);
  pdf.save('AutoCalc_Report.pdf');
  document.body.removeChild(page);
}

/* ======================= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======================= */
document.addEventListener('DOMContentLoaded', () => {
  initRates();

  // —Å–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∞—Å—á—ë—Ç–∞ —Ç–∞–º–æ–∂–Ω–∏
  ['priceKrw','expensesKrw','eurRub','krwRub','engineCc','motorKw','customsValueRub',
   'autoDuty','autoCustomsFee','autoUtil','autoTotalCustoms','dutyRub','rubUsdt','usdtKrw'
  ].forEach(id => {
    const el = sel(id);
    if (el) el.addEventListener('input', autoCustomsRecalc);
  });

  document.querySelectorAll('input[name="importer"], input[name="eng"], input[name="age"], input[name="age_ev"]')
    .forEach(el => el.addEventListener('change', () => {
      toggleEngineUI();
      autoCustomsRecalc();
    }));

  toggleEngineUI(); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –î–í–°/EV
});
</script>
</body>
</html>
