<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</title>

<link rel="icon" href="icon.png" type="image/png" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="manifest" href="manifest.json" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  :root { --blue:#0b69ff; --bg:#f0f2f5; --shadow:0 4px 10px rgba(0,0,0,.1); }
  *{ box-sizing:border-box }
  body{ font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
        background:var(--bg); color:#111; margin:0; padding:20px; overflow-x:hidden; }
  .wrap{ max-width:720px; margin:0 auto; }
  h2{ text-align:center; color:var(--blue); margin:0 0 20px; }
  .section{ padding:20px; margin-bottom:15px; border-radius:12px; color:#fff;
            box-shadow:var(--shadow); transition:background .3s; }
  .korea{ background:#4fc3f7 } .currency{ background:#26a69a } .russia{ background:#81c784 }
  .section h3{ margin:0 0 6px }
  .section label{ display:block; margin-top:10px; font-weight:700 }
  input, select{ width:100%; padding:10px; margin-top:6px; border-radius:8px; border:none; font-size:16px; }
  .row{ display:flex; gap:10px; flex-wrap:wrap }
  .row > div { flex:1 1 200px }
  .subpanel{ margin-top:12px; background:#f7f7f8; border:1px solid #e5e7eb;
             border-radius:10px; padding:12px; color:#111; }
  .subpanel h4{ margin:0 0 8px; font-size:16px; color:#0f172a }
  .note{ font-size:12px; color:#475569; margin-top:4px }
  .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
         background:#eef2ff; color:#334155; font-weight:700; font-size:12px; margin-right:8px }
  .muted{ color:#64748b; font-weight:600; font-size:12px }
  .tag{ font-size:12px; color:#111; background:#fff3cd; border:1px dashed #f59e0b; padding:2px 6px; border-radius:6px }
  .auto-output{ background:#fff8e1 }
  .insurance-row{ display:flex; align-items:center; gap:10px;
    margin:12px 0 4px; background:#f7f7f8; border:1px solid #e5e7eb;
    border-radius:10px; padding:10px 12px; box-shadow:var(--shadow); color:#111; }
  .insurance-row input{ width:20px; height:20px }
  .insurance-row label{ flex:1; font-weight:600; line-height:1.3 }
  button{ width:100%; padding:14px; margin-top:15px; font-size:18px; border:none; border-radius:10px;
          cursor:pointer; background:var(--blue); color:#fff; font-weight:700; transition:.2s; box-shadow:var(--shadow); }
  button:hover{ background:#0756d1 }
  button.clear{ background:#ccc; color:#111 }
  button.pdf{ background:#0b69ff; color:#fff }
  .result{ margin-top:20px; padding:20px; border-radius:12px; background:#fff3e0; font-size:18px; box-shadow:var(--shadow); }
  .result p{ margin:10px 0; font-weight:700 }
  hr{ border:0; border-top:2px dashed #ccc; margin:10px 0 }
  .radio-line{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }
  .radio-line label{ font-weight:600; color:#111; background:#e2e8f0; padding:6px 10px; border-radius:8px; cursor:pointer }
  .radio-line input{ width:auto; margin-right:6px }
  .grid{ display:grid; grid-template-columns: 1fr auto; gap:8px 10px; align-items:center }
</style>
</head>
<body>
<main class="wrap">

  <h2>üöó –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –∞–≤—Ç–æ –∏–∑ –ö–æ—Ä–µ–∏</h2>

  <div class="section korea" id="blockKorea">
    <h3>üá∞üá∑ –ö–æ—Ä–µ—è</h3>
    <label>–¶–µ–Ω–∞ –∞–≤—Ç–æ (‚Ç©): <input type="number" id="priceKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∞–≤—Ç–æ"></label>
    <label>–†–∞—Å—Ö–æ–¥—ã –≤ –ö–æ—Ä–µ–µ –≤–∫–ª—é—á–∞—è —Ñ—Ä–∞—Ö—Ç (‚Ç©): <input type="number" id="expensesKrw" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã"></label>
  </div>

  <div class="section currency" id="blockCurrency">
    <h3>üí± –ö—É—Ä—Å –≤–∞–ª—é—Ç</h3>
    <div class="row">
      <div>
        <label>USDT ‚Üí ‚ÇΩ:
          <input type="number" id="rubUsdt" step="0.0001" placeholder="–∞–≤—Ç–æ">
        </label>
      </div>
      <div>
        <label>USDT ‚Üí ‚Ç©:
          <input type="number" id="usdtKrw" step="0.01" placeholder="–∞–≤—Ç–æ">
        </label>
      </div>
    </div>
    <div class="note"><span class="chip">Binance/Coingecko</span> –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ ‚Ä¢ –º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é</div>
  </div>

  <div class="section russia" id="blockRussia">
    <h3>üá∑üá∫ –†–æ—Å—Å–∏—è</h3>

    <div class="subpanel" id="autoCustoms">
      <h4>‚öôÔ∏è –ê–≤—Ç–æ—Ä–∞—Å—á—ë—Ç –ø–æ—à–ª–∏–Ω—ã –∏ —Å–±–æ—Ä–æ–≤</h4>

      <div class="row">
        <div>
          <div class="muted">–¢–∏–ø –≤–≤–æ–∑—è—â–µ–≥–æ</div>
          <div class="radio-line">
            <label><input type="radio" name="importer" value="individual" checked> –§–∏–∑–ª–∏—Ü–æ</label>
            <label><input type="radio" name="importer" value="business"> –Æ—Ä–ª–∏—Ü–æ / –ò–ü</label>
          </div>
        </div>
        <div>
          <div class="muted">–¢–∏–ø –¥–≤–∏–≥–∞—Ç–µ–ª—è</div>
          <div class="radio-line">
            <label><input type="radio" name="eng" value="ice" checked> –î–í–°</label>
            <label><input type="radio" name="eng" value="ev"> –≠–ª–µ–∫—Ç—Ä–æ</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsICE">
        <div>
          <label>–û–±—ä—ë–º –¥–≤–∏–≥–∞—Ç–µ–ª—è (—Å–º¬≥): <input type="number" id="engineCc"></label>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç</div>
          <div class="radio-line">
            <label><input type="radio" name="age" value="<3" checked> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age" value="3-5"> 3‚Äì5</label>
            <label><input type="radio" name="age" value=">5"> –°—Ç–∞—Ä—à–µ 5</label>
          </div>
        </div>
      </div>

      <div class="row" id="paramsEV" style="display:none">
        <div>
          <label>–ú–æ—â–Ω–æ—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–¥–≤–∏–≥–∞—Ç–µ–ª—è (–∫–í—Ç): <input type="number" id="motorKw"></label>
        </div>
        <div>
          <div class="muted">–í–æ–∑—Ä–∞—Å—Ç</div>
          <div class="radio-line">
            <label><input type="radio" name="age_ev" value="<3" checked> –ú–ª–∞–¥—à–µ 3</label>
            <label><input type="radio" name="age_ev" value=">=3"> 3 –∏ —Å—Ç–∞—Ä—à–µ</label>
          </div>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div class="muted">–ö—É—Ä—Å EUR ‚Üí ‚ÇΩ (–¶–ë)</div>
          <input class="auto-output" id="eurRub" readonly>
          <div class="muted">–ö—É—Ä—Å KRW ‚Üí ‚ÇΩ (–¶–ë)</div>
          <input class="auto-output" id="krwRub" readonly>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div>–¶–µ–Ω–∞ –∞–≤—Ç–æ —Å –ø–æ—à–ª–∏–Ω–æ–π –∏ —Å–±–æ—Ä–∞–º–∏ (‚ÇΩ)</div>
          <input class="auto-output" id="priceWithDutyRub" readonly>
        </div>
      </div>

      <div class="subpanel">
        <div class="grid">
          <div>–ü–æ—à–ª–∏–Ω–∞ (‚ÇΩ)</div><input class="auto-output" id="autoDuty" readonly>
          <div>–¢–∞–º–æ–∂–µ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div><input class="auto-output" id="autoCustomsFee" readonly>
          <div>–£—Ç–∏–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–±–æ—Ä (‚ÇΩ)</div><input class="auto-output" id="autoUtil" readonly>
          <div><strong>–ò—Ç–æ–≥–æ ¬´–ü–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã¬ª (‚ÇΩ)</strong></div><input class="auto-output" id="autoTotalCustoms" readonly>
        </div>
      </div>
    </div>

    <label>–¢–∞–º–æ–∂–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —É—Å–ª—É–≥–∏ –±—Ä–æ–∫–µ—Ä–∞ (‚ÇΩ): <input type="number" id="brokerRub"></label>
    <label>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –†–æ—Å—Å–∏–∏ (‚ÇΩ): <input type="number" id="deliveryRub"></label>
  </div>

  <div class="insurance-row">
    <input type="checkbox" id="insuranceCheck"><label for="insuranceCheck">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É 0,3%</label>
  </div>

  <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
  <button class="clear" onclick="clearAll()">–û—á–∏—Å—Ç–∏—Ç—å</button>

  <div class="result" id="result"></div>
</main>

<script>
const sel=id=>document.getElementById(id);
const toNum=v=>(parseFloat(String(v).replace(/\s/g,'').replace(',','.')))||0;

// –ø—Ä–∏–º–µ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π –ø–æ—à–ª–∏–Ω—ã/—É—Ç–∏–ª—å (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ)
function calcDutyICE({cc,tsRub,eurRub}){ return Math.max(tsRub*0.15, cc*2.5*eurRub); }
function calcDutyEV({tsRub}){ return tsRub*0.15; }
function calcCustomsFee(ts){ return ts<200000?500:1000; }
function calcUtil({isEV,cc,kw}){ return isEV?20000*(kw>85?0.26:0.17):20000*(cc>2000?0.34:0.17); }

// –∫—É—Ä—Å—ã
async function fetchCbrRates(){
  const res=await fetch('https://www.cbr-xml-daily.ru/daily_json.js'); const d=await res.json();
  sel('eurRub').value=(d.Valute.EUR.Value/d.Valute.EUR.Nominal).toFixed(2);
  sel('krwRub').value=(d.Valute.KRW.Value/d.Valute.KRW.Nominal).toFixed(6);
}
async function fetchUsdtRates(){
  const res=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tether&vs_currencies=rub,krw');
  const j=await res.json();
  sel('rubUsdt').value=j.tether.rub.toFixed(4);
  sel('usdtKrw').value=j.tether.krw.toFixed(2);
}

function autoCustomsRecalc(){
  const eurRub=toNum(sel('eurRub').value), krwRub=toNum(sel('krwRub').value);
  const priceKrw=toNum(sel('priceKrw').value), cc=toNum(sel('engineCc').value), kw=toNum(sel('motorKw').value);
  const tsRub=(priceKrw+toNum(sel('expensesKrw').value))*krwRub;

  let duty,util; const isEV=document.querySelector('input[name="eng"]:checked').value==='ev';
  if(isEV){ duty=calcDutyEV({tsRub}); util=calcUtil({isEV:true,kw}); }
  else{ duty=calcDutyICE({cc,tsRub,eurRub}); util=calcUtil({isEV:false,cc}); }
  const fee=calcCustomsFee(tsRub), totalCustoms=Math.round(duty+fee+util);

  sel('autoDuty').value=Math.round(duty);
  sel('autoCustomsFee').value=Math.round(fee);
  sel('autoUtil').value=Math.round(util);
  sel('autoTotalCustoms').value=totalCustoms;

  // –Ω–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞: —Ü–µ–Ω–∞ –∞–≤—Ç–æ –≤ KRW √ó –∫—É—Ä—Å KRW‚ÜíRUB + –∏—Ç–æ–≥–æ –ø–æ—à–ª–∏–Ω–∞ –∏ —Å–±–æ—Ä—ã
  const carPriceRub=priceKrw*krwRub;
  sel('priceWithDutyRub').value=Math.round(carPriceRub+totalCustoms);
}

function calculate(){
  const rubUsdt=toNum(sel('rubUsdt').value), usdtKrw=toNum(sel('usdtKrw').value);
  const koreaKrw=toNum(sel('priceKrw').value)+toNum(sel('expensesKrw').value);
  const rubNeeded=usdtKrw?(koreaKrw/usdtKrw)*rubUsdt:0;

  const russiaSubtotal=toNum(sel('autoTotalCustoms').value)+toNum(sel('brokerRub').value)+toNum(sel('deliveryRub').value);
  const preFinal=rubNeeded+russiaSubtotal;
  const insurance=sel('insuranceCheck').checked?preFinal*0.003:0;
  const finalRub=preFinal+insurance;

  sel('result').innerHTML=`<p>üí∞ –í –ö–æ—Ä–µ–µ: ${rubNeeded.toLocaleString('ru-RU')} ‚ÇΩ</p>
    <p>üí∞ –í –†–æ—Å—Å–∏–∏: ${russiaSubtotal.toLocaleString('ru-RU')} ‚ÇΩ</p>
    ${insurance?`<p>üõ°Ô∏è –°—Ç—Ä–∞—Ö–æ–≤–∫–∞: ${insurance.toLocaleString('ru-RU')} ‚ÇΩ</p>`:''}
    <hr><p>üèÅ –ü–æ–¥ –∫–ª—é—á: <strong>${finalRub.toLocaleString('ru-RU')} ‚ÇΩ</strong></p>`;
}

function clearAll(){ document.querySelectorAll('input').forEach(i=>i.value=''); sel('result').innerHTML=''; }

document.addEventListener('DOMContentLoaded',()=>{ fetchCbrRates(); fetchUsdtRates();
  document.querySelectorAll('input').forEach(el=>el.addEventListener('input',autoCustomsRecalc));
  document.querySelectorAll('input[name="eng"]').forEach(el=>el.addEventListener('change',()=>{ 
    sel('paramsICE').style.display=(el.value==='ice'&&el.checked)?'flex':'none';
    sel('paramsEV').style.display=(el.value==='ev'&&el.checked)?'flex':'none';
    autoCustomsRecalc();
  }));
});
</script>
</body>
</html>
